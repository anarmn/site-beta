<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="./css/styles.css" type="text/css">
    <link rel="stylesheet" href="./css/index.css" type="text/css">

    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon" />
</head>
<body>
    <header>
        <p class="name">Roman Ana-Maria<p>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="portfolio.html">Portfolio</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="film.html">Film</a></li>
            </ul>
        </nav>
    </header>

    <div id="galleryContainer" class="flex-container">
        <div id="leftRow" class="column movement-left">
                <div class="gallery-item">
                    <img src="img/home/home-left-1.jpeg" alt="gallery item">
                    <p class="img-desc">January 21, 2021</p>
                </div>
            

                <div class="gallery-item">
                    <img src="img/home/home-left-2.jpeg" alt="gallery item">
                    <p class="img-desc">July 7, 2020</p>
                </div>
        </div>
        <div id="rightRow" class="column movement-right">
            <div class="gallery-item">
                <img src="img/home/home-right-1.jpeg" alt="gallery item">
                <p class="img-desc">August 26, 2019</p>
            </div>

             <div class="gallery-item">
                <img src="img/home/home-right-2.jpeg" alt="gallery item">
                <p class="img-desc">November 2, 2020</p>
             </div>
        </div>    
    </div>  
    <script src="exif-js-master/exif.js"></script>
    <script>
        let nextImageIndexLeft = 2;
        let nextImageIndexRight = 2;
        const maxLeft = 11;
        const maxRight = 8;

        function checkIfImageExists(src, successCallback) {
            const img = new Image();
            img.onload = successCallback;
            img.src = src;
        };

        function loadMoreImages() {
            const leftGalleryRow = document.getElementById("leftRow");
            const rightGalleryRow = document.getElementById("rightRow");

            if (nextImageIndexLeft + 1 <= maxLeft) {
                const leftImageDiv = document.createElement("div");
                leftImageDiv.className = "gallery-item";
                const leftNewImage = document.createElement("img");

                leftNewImage.src = "img/home/home-left-" + (nextImageIndexLeft + 1) + ".jpeg";
                leftNewImage.className = "image";
                const pWithDateForLeft = document.createElement("p");
                pWithDateForLeft.id = "home-left-" + (nextImageIndexLeft + 1);
                pWithDateForLeft.className = "img-desc";
                extractExifData(leftNewImage, "home-left-" + (nextImageIndexLeft + 1), handleExifData);
                leftImageDiv.appendChild(leftNewImage);
                leftImageDiv.appendChild(pWithDateForLeft);
                leftGalleryRow.appendChild(leftImageDiv);
                nextImageIndexLeft++;
            }

            if (nextImageIndexRight + 1 <= maxRight) {
                const rightImageDiv = document.createElement("div");
                rightImageDiv.className = "gallery-item";
                const rightNewImage = document.createElement("img");

                rightNewImage.src = "img/home/home-right-" + (nextImageIndexRight + 1) + ".jpeg";
                rightNewImage.className = "image";
                const pWithDateForRight = document.createElement("p");
                pWithDateForRight.id = "home-right-" + (nextImageIndexRight + 1);
                pWithDateForRight.className = "img-desc";
                extractExifData(rightNewImage, "home-right-" + (nextImageIndexRight + 1), handleExifData);

                rightImageDiv.appendChild(rightNewImage);
                rightImageDiv.append(pWithDateForRight);
                rightGalleryRow.appendChild(rightImageDiv);
                nextImageIndexRight++;
            }
        }

        window.addEventListener("scrollend", function() {
            if (isScrolledToBottom() && ((nextImageIndexRight + 1 <= maxRight) || (nextImageIndexLeft + 1 <= maxLeft))) {
                loadMoreImages();
            }
        });

        function isScrolledToBottom() {
            // Calculate the current scroll position
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            // Calculate the total height of the document
            const documentHeight = document.documentElement.scrollHeight;
            // Calculate the height of the viewport
            const windowHeight = window.innerHeight;
            // Calculate how far the user has scrolled from the top
            const scrollPosition = scrollTop + windowHeight;
            // Check if the user has scrolled to the bottom of the page
            return scrollPosition >= documentHeight - 350;
        }

        function formatDate(inputDate) {
            const [datePart, timePart] = inputDate.split(' ');
            const [year, month, day] = datePart.split(':');

            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            const newDate = new Date(year, month - 1, day);
            const monthName = monthNames[newDate.getMonth()];
            const yearPart = year;
            const formattedDate = `${monthName} ${day}, ${yearPart}`;
            return formattedDate;
        }

        function handleExifData(dateTimeOriginal, pId) {
            const p = document.getElementById(pId);
            if (dateTimeOriginal) {
                p.innerHTML = formatDate(dateTimeOriginal);
            }
        }

        function extractExifData(image, pId, callback) {
            image.onload = function() {
                EXIF.getData(image, function () {
                    const dateTimeOriginal = EXIF.getTag(this, "DateTimeOriginal");
                    if (dateTimeOriginal) {
                    callback(dateTimeOriginal, pId);
                    } 
                })
            }
        }
    </script>
</body>
</html>